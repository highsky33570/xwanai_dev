# Character App - Project Structure Definition
# Next.js 15 Character Creation and Management Application

## üìã Project Overview
- **Framework**: Next.js 15 with App Router
- **Database**: Supabase PostgreSQL
- **Authentication**: Supabase Auth
- **UI Framework**: NextUI + TailwindCSS
- **Language**: TypeScript
- **Styling**: Custom dark theme with height-based color system
- **Package Manager**: pnpm
- **API Architecture**: Direct frontend calls to external API (no proxy)

## üèóÔ∏è Architecture Layers

### **Presentation Layer** (`app/`, `components/`)
- Next.js App Router pages
- Reusable UI components
- Layout components
- Route groups for organization

### **Business Logic Layer** (`lib/`)
- Authentication operations
- Database operations
- Direct API client integrations (no proxy)
- Utility functions

### **Data Layer** (`lib/supabase/`, External API)
- Supabase client configuration
- Database schemas and types
- Direct external API integrations (https://divination.uubb.top)

## üìÅ Directory Structure

### **Root Configuration**
```
/
‚îú‚îÄ‚îÄ package.json              # Dependencies and scripts
‚îú‚îÄ‚îÄ next.config.mjs           # Next.js configuration
‚îú‚îÄ‚îÄ tailwind.config.js        # TailwindCSS + NextUI theme
‚îú‚îÄ‚îÄ tsconfig.json             # TypeScript configuration
‚îú‚îÄ‚îÄ postcss.config.mjs        # PostCSS configuration
‚îú‚îÄ‚îÄ .env.local                # Environment variables
‚îú‚îÄ‚îÄ .projectrc                # Project structure (this file)
‚îú‚îÄ‚îÄ .definitionrc             # Database schema definition
‚îú‚îÄ‚îÄ .sessionrc                # Comprehensive session context
‚îú‚îÄ‚îÄ .note                     # Manual project notes
‚îî‚îÄ‚îÄ openapi.json              # API definition
```

### **Application Routes** (`app/`)
```
app/
‚îú‚îÄ‚îÄ layout.tsx                # Root application layout
‚îú‚îÄ‚îÄ clientLayout.tsx          # Client-side providers wrapper
‚îú‚îÄ‚îÄ providers.tsx             # React context providers
‚îú‚îÄ‚îÄ page.tsx                  # Homepage with character feed
‚îú‚îÄ‚îÄ loading.tsx               # Global loading component
‚îú‚îÄ‚îÄ globals.css               # Global styles and CSS variables
‚îÇ
‚îú‚îÄ‚îÄ (base)/                   # Main application routes
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx            # Base layout
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # Base homepage
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx          # Personal character database
‚îÇ   ‚îú‚îÄ‚îÄ character/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # Character type selection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ designer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx      # Character editor
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ loading.tsx   # Designer loading
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ info/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ page.tsx      # Character detail view
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ loading.tsx   # Info loading
‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ my-info/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # Current user profile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ other/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx      # Other user profiles
‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx          # Application settings
‚îÇ
‚îú‚îÄ‚îÄ (chat)/                   # Chat application routes
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx            # Chat layout
‚îÇ   ‚îî‚îÄ‚îÄ chat/
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx          # Chat list
‚îÇ       ‚îî‚îÄ‚îÄ [id]/
‚îÇ           ‚îî‚îÄ‚îÄ page.tsx      # Individual chat
‚îÇ
‚îî‚îÄ‚îÄ (login)/                  # Authentication routes
    ‚îú‚îÄ‚îÄ layout.tsx            # Auth layout
    ‚îú‚îÄ‚îÄ login/
    ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx          # Login page
    ‚îú‚îÄ‚îÄ register/
    ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx          # Registration page
    ‚îî‚îÄ‚îÄ restore-password/
        ‚îî‚îÄ‚îÄ page.tsx          # Password reset
```

### **Component Library** (`components/`)
```
components/
‚îú‚îÄ‚îÄ theme-provider.tsx        # Theme context provider
‚îÇ
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îî‚îÄ‚îÄ login-modal.tsx       # Modal login interface
‚îÇ
‚îú‚îÄ‚îÄ character/
‚îÇ   ‚îú‚îÄ‚îÄ character-card.tsx             # Character grid card
‚îÇ   ‚îú‚îÄ‚îÄ character-card-database.tsx    # Horizontal database card
‚îÇ   ‚îú‚îÄ‚îÄ character-creation-modal.tsx   # Creation form modal
‚îÇ   ‚îú‚îÄ‚îÄ character-type-card.tsx        # Type selection card
‚îÇ   ‚îú‚îÄ‚îÄ character-preview.tsx          # Detailed preview
‚îÇ   ‚îú‚îÄ‚îÄ character-actions.tsx          # Interaction buttons
‚îÇ   ‚îî‚îÄ‚îÄ comment-section.tsx            # Comments interface
‚îÇ
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ database-header.tsx    # Database page header
‚îÇ   ‚îú‚îÄ‚îÄ database-controls.tsx  # Search and controls
‚îÇ   ‚îî‚îÄ‚îÄ character-list.tsx     # Character list display
‚îÇ
‚îú‚îÄ‚îÄ navigation/
‚îÇ   ‚îî‚îÄ‚îÄ navbar.tsx            # Main navigation bar
‚îÇ
‚îú‚îÄ‚îÄ search/
‚îÇ   ‚îî‚îÄ‚îÄ search-bar.tsx        # Search with filters
‚îÇ
‚îú‚îÄ‚îÄ sidebar/
‚îÇ   ‚îú‚îÄ‚îÄ accordion-sidebar.tsx     # Main accordion menu
‚îÇ   ‚îî‚îÄ‚îÄ multi-layout-sidebar.tsx  # Alternative sidebar
‚îÇ
‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îú‚îÄ‚îÄ user-profile-header.tsx   # Profile header
‚îÇ   ‚îî‚îÄ‚îÄ user-character-grid.tsx   # User's character grid
‚îÇ
‚îî‚îÄ‚îÄ ui/                       # NextUI base components
    ‚îú‚îÄ‚îÄ button.tsx            # Button component
    ‚îú‚îÄ‚îÄ card.tsx              # Card component
    ‚îú‚îÄ‚îÄ input.tsx             # Input component
    ‚îú‚îÄ‚îÄ modal.tsx             # Modal component
    ‚îî‚îÄ‚îÄ [various UI components...]
```

### **Business Logic** (`lib/`)
```
lib/
‚îú‚îÄ‚îÄ utils.ts                  # General utilities
‚îÇ
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ client.ts            # External API client
‚îÇ   ‚îî‚îÄ‚îÄ types.ts             # API TypeScript interfaces
‚îÇ
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ client.ts            # Supabase client config
‚îÇ   ‚îú‚îÄ‚îÄ server.ts            # Server-side client
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts              # Authentication operations
‚îÇ   ‚îú‚îÄ‚îÄ database.ts          # Database operations
‚îÇ   ‚îî‚îÄ‚îÄ types.ts             # Database TypeScript types
‚îÇ
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ logger.ts            # Structured logging system
    ‚îî‚îÄ‚îÄ translations.ts      # i18n translations (en/zh)
```

### **Static Assets** (`public/`)
```
public/
‚îú‚îÄ‚îÄ placeholder-logo.png      # Application logo
‚îú‚îÄ‚îÄ placeholder-logo.svg     # SVG logo
‚îú‚îÄ‚îÄ placeholder-user.jpg     # Default user avatar
‚îú‚îÄ‚îÄ placeholder.jpg          # General placeholder
‚îî‚îÄ‚îÄ placeholder.svg          # SVG placeholder
```

### **Development Tools**
```
hooks/
‚îú‚îÄ‚îÄ use-mobile.tsx           # Mobile detection hook
‚îî‚îÄ‚îÄ use-toast.ts             # Toast notification hook

.cursor/
‚îî‚îÄ‚îÄ rules/
    ‚îî‚îÄ‚îÄ database.mdc         # Cursor IDE rules
```

## üîß Key System Components

### **Authentication System**
- **Location**: `lib/supabase/auth.ts`
- **Features**: Registration, login, session management
- **Integration**: Navbar, protected routes, user context

### **Database Operations**
- **Location**: `lib/supabase/database.ts`
- **Features**: CRUD operations, search, user-specific queries
- **Tables**: characters, profiles, comments, likes

### **External API Integration**
- **Location**: `lib/api/client.ts`
- **Features**: Character creation, avatar upload, astrology services
- **Architecture**: Direct frontend calls to https://divination.uubb.top
- **Endpoints**: Character API, User API, Chat API
- **No Proxy**: Eliminates Next.js API route proxy layer for better performance

### **UI Theme System**
- **Location**: `tailwind.config.js`, `app/globals.css`
- **Features**: Dark theme, height-based colors, responsive design
- **Colors**: Primary/secondary palette, background height system

### **Internationalization System**
- **Location**: `lib/utils/translations.ts`
- **Languages**: English (en), Simplified Chinese (zh)
- **Features**: Custom i18n hook, language persistence, real-time switching
- **Usage**: All user-facing text across the application

### **Logging System**
- **Location**: `lib/utils/logger.ts`
- **Features**: Structured logging, performance timing, data sanitization
- **Usage**: Authentication, database operations, API requests

## üìä Data Flow Architecture

### **Authentication Flow**
```
User Input ‚Üí Auth Component ‚Üí Supabase Auth ‚Üí User State ‚Üí UI Update
```

### **Character Management Flow**
```
User Action ‚Üí Component ‚Üí Database/API ‚Üí State Update ‚Üí UI Refresh
```

### **Search and Discovery Flow**
```
Search Input ‚Üí API/Database Query ‚Üí Results Processing ‚Üí Character Display
```

## üöÄ Route Organization Strategy

### **Route Groups**
- **(base)**: Main authenticated application
- **(chat)**: Chat and messaging features
- **(login)**: Authentication flows

### **Page Hierarchy**
- **Public**: Homepage, character discovery
- **Protected**: User profiles, character creation, database
- **Authentication**: Login, register, password reset

## üì¶ Component Architecture

### **Layout Components**
- Root layout with metadata
- Client layout with providers
- Route-specific layouts

### **Feature Components**
- Character management suite
- User profile components
- Authentication interfaces

### **UI Components**
- NextUI base components
- Custom styled components
- Utility components

## üîó Integration Points

### **Supabase Integration**
- Authentication with user metadata
- Real-time database operations
- File storage for avatars

### **External API Integration**
- **Direct Calls**: Frontend directly communicates with https://divination.uubb.top
- **Character creation services**: `/api/bazi/v1/character`
- **Astrology/bazi calculations**: `/api/bazi/v1`
- **Chat message processing**: `/api/chat/v1`
- **Avatar uploads**: `/api/users/v1/avatar`
- **No Proxy Layer**: Improved performance and simplified architecture

### **NextUI Integration**
- Theme customization
- Component styling
- Responsive design patterns

## üìù Development Guidelines

### **File Naming Convention**
- Pages: `page.tsx`, `layout.tsx`, `loading.tsx`
- Components: `kebab-case.tsx`
- Utilities: `camelCase.ts`

### **Import Strategy**
- Absolute imports with `@/` prefix
- Component-specific imports
- Utility function grouping

### **State Management**
- React hooks for local state
- Supabase for global state
- Real-time subscriptions where needed

### **Internationalization (i18n) Guidelines**
- **Location**: `lib/utils/translations.ts`
- **Languages**: English (en) and Simplified Chinese (zh)
- **Usage**: Always use `useTranslation()` hook for user-facing text
- **Translation Keys**: Use dot notation (e.g., `t("tasks.title")`)
- **Rules**:
  - ‚ùå **NEVER** hardcode user-facing text strings in components
  - ‚úÖ **ALWAYS** add translations to both `en` and `zh` sections
  - ‚úÖ Use descriptive translation keys organized by feature
  - ‚úÖ Keep translation structure consistent across languages
  - ‚úÖ Use placeholders `{count}`, `{name}` for dynamic content
  - ‚úÖ Test with both English and Chinese to ensure proper display
- **Example**:
  ```tsx
  import { useTranslation } from "@/lib/utils/translations"
  
  const MyComponent = () => {
    const { t } = useTranslation()
    return <h1>{t("section.title")}</h1>
  }
  ```

## üè∑Ô∏è Technology Stack Summary

### **Core Technologies**
- **Frontend**: Next.js 15 (App Router)
- **Styling**: TailwindCSS + NextUI
- **Backend**: Supabase (Auth + Database) + External API (Direct)
- **Language**: TypeScript
- **Package Manager**: pnpm

### **Key Dependencies**
- `@heroui/react`: UI component library
- `@supabase/supabase-js`: Database and auth client
- `framer-motion`: Animation library
- `lucide-react`: Icon library
- `react-hook-form`: Form management

### **Development Tools**
- ESLint + Prettier: Code formatting
- TypeScript: Type safety
- Tailwind IntelliSense: CSS assistance

---

This project structure supports a comprehensive character creation and management application with robust authentication, database operations, direct external API integration (no proxy), and a modern UI framework. 